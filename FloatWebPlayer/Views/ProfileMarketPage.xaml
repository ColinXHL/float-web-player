<UserControl x:Class="FloatWebPlayer.Views.ProfileMarketPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helpers="clr-namespace:FloatWebPlayer.Helpers"
             Background="Transparent"
             Cursor="Arrow">
    
    <UserControl.Resources>
        <!-- å€¼è½¬æ¢å™¨ -->
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <helpers:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <helpers:ZeroToVisibleConverter x:Key="ZeroToVisibleConverter"/>

        <!-- æœç´¢æ¡†æ ·å¼ -->
        <Style x:Key="SearchBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#2A2A2A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3A3A3A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- æ’ä»¶å¡ç‰‡æ ·å¼ -->
        <Style x:Key="PluginCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#252525"/>
            <Setter Property="BorderBrush" Value="#333"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- æŒ‰é’®æ ·å¼ -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#333"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#444"/>
                                <Setter Property="Cursor" Value="Hand"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#555"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#2A2A2A"/>
                                <Setter Property="Foreground" Value="#666"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ä¸»æŒ‰é’®æ ·å¼ -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="#0078D4"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1084D8"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#006CBD"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- æ·±è‰²æ»šåŠ¨æ¡æ ·å¼ -->
        <Style x:Key="DarkScrollBarThumb" TargetType="Thumb">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border Background="#555" CornerRadius="3" Margin="2"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkScrollBar" TargetType="ScrollBar">
            <Setter Property="Width" Value="8"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid>
                            <Border Background="#2A2A2A" CornerRadius="4"/>
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource DarkScrollBarThumb}"/>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkScrollViewer" TargetType="ScrollViewer">
            <Setter Property="Cursor" Value="Arrow"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ScrollContentPresenter Grid.Column="0"/>
                            <ScrollBar x:Name="PART_VerticalScrollBar" Grid.Column="1"
                                       Style="{StaticResource DarkScrollBar}"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="Profile å¸‚åœº" FontSize="18" FontWeight="SemiBold" 
                       Foreground="White" VerticalAlignment="Center"/>
            <Button x:Name="BtnManageSources" Grid.Column="1" Content="âš™ è®¢é˜…æºç®¡ç†" 
                    Style="{StaticResource ActionButtonStyle}"
                    Click="BtnManageSources_Click"/>
        </Grid>

        <!-- æœç´¢æ¡† -->
        <Grid Grid.Row="1" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox x:Name="SearchBox" Grid.Column="0"
                     Style="{StaticResource SearchBoxStyle}"
                     TextChanged="SearchBox_TextChanged"/>
            <TextBlock Grid.Column="0" Text="ðŸ” æœç´¢ Profile..." 
                       Foreground="#666" FontSize="13"
                       IsHitTestVisible="False" Margin="12,0,0,0"
                       VerticalAlignment="Center"
                       Visibility="{Binding Text.Length, ElementName=SearchBox, 
                                    Converter={StaticResource ZeroToVisibleConverter}}"/>
            <Button x:Name="BtnRefresh" Grid.Column="1" Content="ðŸ”„ åˆ·æ–°" 
                    Style="{StaticResource ActionButtonStyle}"
                    Click="BtnRefresh_Click" Margin="8,0,0,0"/>
        </Grid>

        <!-- å†…å®¹åŒºåŸŸ -->
        <ScrollViewer Grid.Row="2" Style="{StaticResource DarkScrollViewer}" 
                      VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- åŠ è½½çŠ¶æ€ -->
                <TextBlock x:Name="LoadingText" Text="æ­£åœ¨åŠ è½½..." 
                           Foreground="#888" FontSize="13" 
                           HorizontalAlignment="Center" Margin="0,40,0,40"
                           Visibility="Collapsed"/>

                <!-- é”™è¯¯æç¤º -->
                <Border x:Name="ErrorBorder" Visibility="Collapsed"
                        Background="#3A1A1A" CornerRadius="4" Padding="12" Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock x:Name="ErrorText" Grid.Column="0"
                                   Foreground="#F87171" FontSize="13" 
                                   TextWrapping="Wrap" VerticalAlignment="Center"/>
                        <Button Grid.Column="1" Content="é‡è¯•" 
                                Style="{StaticResource ActionButtonStyle}"
                                Click="BtnRefresh_Click" Margin="12,0,0,0"/>
                    </Grid>
                </Border>

                <!-- æ—  Profile æç¤º -->
                <TextBlock x:Name="NoSourcesText" 
                           Text="æš‚æ— å¯ç”¨çš„ Profileï¼Œå¯ç‚¹å‡»ã€Œè®¢é˜…æºç®¡ç†ã€æ·»åŠ ç¬¬ä¸‰æ–¹è®¢é˜…æº" 
                           Foreground="#888" FontSize="13" 
                           HorizontalAlignment="Center" Margin="0,40,0,40"
                           Visibility="Collapsed"/>

                <!-- æ— ç»“æžœæç¤º -->
                <TextBlock x:Name="NoResultsText" 
                           Text="æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ Profile" 
                           Foreground="#666" FontSize="13" 
                           HorizontalAlignment="Center" Margin="0,40,0,40"
                           Visibility="Collapsed"/>

                <!-- Profile åˆ—è¡¨ -->
                <ItemsControl x:Name="ProfileList">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource PluginCardStyle}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Profile ä¿¡æ¯ -->
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ“¦" FontSize="13" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="{Binding Name}" Foreground="White" 
                                                       FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Version, StringFormat=' v{0}'}" 
                                                       Foreground="#666" FontSize="11" 
                                                       VerticalAlignment="Center" Margin="6,0,0,0"/>
                                            <!-- ç›®æ ‡æ¸¸æˆæ ‡ç­¾ -->
                                            <Border Margin="8,0,0,0" VerticalAlignment="Center"
                                                    Background="#1A3A5A" CornerRadius="3" Padding="6,2"
                                                    Visibility="{Binding HasTargetGame, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <TextBlock Text="{Binding TargetGame}" 
                                                           Foreground="#60A5FA" FontSize="10"/>
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Description}" Foreground="#888" FontSize="11"
                                                   TextWrapping="NoWrap" TextTrimming="CharacterEllipsis"
                                                   MaxWidth="400" Margin="0,4,0,0"
                                                   Visibility="{Binding HasDescription, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                            <TextBlock Text="{Binding Author, StringFormat='ä½œè€…: {0}'}" 
                                                       Foreground="#666" FontSize="11"
                                                       Visibility="{Binding HasAuthor, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                            <TextBlock Text=" Â· " Foreground="#444" FontSize="11"
                                                       Visibility="{Binding HasAuthor, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                            <TextBlock Text="{Binding PluginCount, StringFormat='{}{0} ä¸ªæ’ä»¶'}" 
                                                       Foreground="#666" FontSize="11"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- æ“ä½œæŒ‰é’® -->
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                        <Button Content="è¯¦æƒ…" Style="{StaticResource ActionButtonStyle}"
                                                Click="BtnProfileDetails_Click" 
                                                Tag="{Binding}" Margin="0,0,8,0"/>
                                        <!-- å®‰è£…æŒ‰é’®ï¼šæœªå®‰è£…æ—¶æ˜¾ç¤º -->
                                        <Button Content="å®‰è£…" Style="{StaticResource PrimaryButtonStyle}"
                                                Click="BtnProfileInstall_Click" 
                                                Tag="{Binding}"
                                                Visibility="{Binding IsInstalled, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                                        <!-- å¸è½½æŒ‰é’®ï¼šå·²å®‰è£…ä¸”éžé»˜è®¤ Profile æ—¶æ˜¾ç¤º -->
                                        <Button Content="å¸è½½" Style="{StaticResource ActionButtonStyle}"
                                                Click="BtnProfileUninstall_Click" 
                                                Tag="{Binding}"
                                                Visibility="{Binding CanUninstall, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <!-- å·²å®‰è£…æ ‡ç­¾ï¼šå·²å®‰è£…ä½†æ˜¯é»˜è®¤ Profile æ—¶æ˜¾ç¤º -->
                                        <Border Background="#2A3A2A" CornerRadius="4" Padding="12,6"
                                                Visibility="{Binding IsDefaultAndInstalled, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <TextBlock Text="å·²å®‰è£…" Foreground="#4ADE80" FontSize="12"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
