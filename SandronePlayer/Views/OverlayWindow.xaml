<Window x:Class="SandronePlayer.Views.OverlayWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Overlay"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ShowActivated="False"
        ResizeMode="NoResize"
        Width="200"
        Height="200"
        WindowStartupLocation="Manual"
        SourceInitialized="Window_SourceInitialized"
        KeyDown="Window_KeyDown">
    
    <Window.Resources>
        <!-- 方向标记图片样式 -->
        <Style x:Key="DirectionMarkerStyle" TargetType="Image">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Visibility" Value="Collapsed"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" BlurRadius="8" ShadowDepth="2" Opacity="0.6"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 编辑模式控制点样式 -->
        <Style x:Key="ResizeHandleStyle" TargetType="Rectangle">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Height" Value="10"/>
            <Setter Property="Fill" Value="#FF4CAF50"/>
            <Setter Property="Stroke" Value="White"/>
            <Setter Property="StrokeThickness" Value="1"/>
            <Setter Property="Visibility" Value="Collapsed"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <!-- 编辑模式边框 -->
        <Border x:Name="EditBorder" 
                BorderBrush="#FF4CAF50" 
                BorderThickness="2" 
                Background="#22000000"
                Visibility="Collapsed">
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="5" ShadowDepth="0" Opacity="0.5"/>
            </Border.Effect>
        </Border>
        
        <!-- 通用绘图元素容器 -->
        <Canvas x:Name="DrawingCanvas"/>
        
        <!-- 主容器：使用 Canvas 精确定位方向标记 -->
        <Canvas x:Name="OverlayCanvas">
        
        <!-- 方向标记图片：基础朝向为向右（东） -->
        
        <!-- 北 (上) - 旋转 270° 指向中心 -->
        <Image x:Name="MarkerNorth" Style="{StaticResource DirectionMarkerStyle}">
            <Image.RenderTransform>
                <RotateTransform Angle="270"/>
            </Image.RenderTransform>
        </Image>
        
        <!-- 东北 (右上) - 旋转 315° 指向中心 -->
        <Image x:Name="MarkerNorthEast" Style="{StaticResource DirectionMarkerStyle}">
            <Image.RenderTransform>
                <RotateTransform Angle="315"/>
            </Image.RenderTransform>
        </Image>
        
        <!-- 东 (右) - 旋转 0° 指向中心 -->
        <Image x:Name="MarkerEast" Style="{StaticResource DirectionMarkerStyle}">
            <Image.RenderTransform>
                <RotateTransform Angle="0"/>
            </Image.RenderTransform>
        </Image>
        
        <!-- 东南 (右下) - 旋转 45° 指向中心 -->
        <Image x:Name="MarkerSouthEast" Style="{StaticResource DirectionMarkerStyle}">
            <Image.RenderTransform>
                <RotateTransform Angle="45"/>
            </Image.RenderTransform>
        </Image>
        
        <!-- 南 (下) - 旋转 90° 指向中心 -->
        <Image x:Name="MarkerSouth" Style="{StaticResource DirectionMarkerStyle}">
            <Image.RenderTransform>
                <RotateTransform Angle="90"/>
            </Image.RenderTransform>
        </Image>
        
        <!-- 西南 (左下) - 旋转 135° 指向中心 -->
        <Image x:Name="MarkerSouthWest" Style="{StaticResource DirectionMarkerStyle}">
            <Image.RenderTransform>
                <RotateTransform Angle="135"/>
            </Image.RenderTransform>
        </Image>
        
        <!-- 西 (左) - 旋转 180° 指向中心 -->
        <Image x:Name="MarkerWest" Style="{StaticResource DirectionMarkerStyle}">
            <Image.RenderTransform>
                <RotateTransform Angle="180"/>
            </Image.RenderTransform>
        </Image>
        
        <!-- 西北 (左上) - 旋转 225° 指向中心 -->
        <Image x:Name="MarkerNorthWest" Style="{StaticResource DirectionMarkerStyle}">
            <Image.RenderTransform>
                <RotateTransform Angle="225"/>
            </Image.RenderTransform>
        </Image>
        
        </Canvas>
        
        <!-- 编辑模式控制点 -->
        <Canvas x:Name="ResizeHandlesCanvas" Visibility="Collapsed">
            <!-- 四角控制点 -->
            <Rectangle x:Name="HandleTopLeft" Style="{StaticResource ResizeHandleStyle}" 
                       Cursor="SizeNWSE" Canvas.Left="-5" Canvas.Top="-5"
                       MouseLeftButtonDown="Handle_MouseLeftButtonDown"/>
            <Rectangle x:Name="HandleTopRight" Style="{StaticResource ResizeHandleStyle}" 
                       Cursor="SizeNESW" Canvas.Top="-5"
                       MouseLeftButtonDown="Handle_MouseLeftButtonDown"/>
            <Rectangle x:Name="HandleBottomLeft" Style="{StaticResource ResizeHandleStyle}" 
                       Cursor="SizeNESW" Canvas.Left="-5"
                       MouseLeftButtonDown="Handle_MouseLeftButtonDown"/>
            <Rectangle x:Name="HandleBottomRight" Style="{StaticResource ResizeHandleStyle}" 
                       Cursor="SizeNWSE"
                       MouseLeftButtonDown="Handle_MouseLeftButtonDown"/>
            
            <!-- 四边中点控制点 -->
            <Rectangle x:Name="HandleTop" Style="{StaticResource ResizeHandleStyle}" 
                       Cursor="SizeNS" Canvas.Top="-5"
                       MouseLeftButtonDown="Handle_MouseLeftButtonDown"/>
            <Rectangle x:Name="HandleBottom" Style="{StaticResource ResizeHandleStyle}" 
                       Cursor="SizeNS"
                       MouseLeftButtonDown="Handle_MouseLeftButtonDown"/>
            <Rectangle x:Name="HandleLeft" Style="{StaticResource ResizeHandleStyle}" 
                       Cursor="SizeWE" Canvas.Left="-5"
                       MouseLeftButtonDown="Handle_MouseLeftButtonDown"/>
            <Rectangle x:Name="HandleRight" Style="{StaticResource ResizeHandleStyle}" 
                       Cursor="SizeWE"
                       MouseLeftButtonDown="Handle_MouseLeftButtonDown"/>
        </Canvas>
        
        <!-- 编辑模式完成按钮 -->
        <Button x:Name="DoneButton" 
                Content="完成" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Bottom"
                Margin="0,0,0,20"
                Padding="15,5"
                FontSize="14"
                Background="#FF4CAF50"
                Foreground="White"
                BorderThickness="0"
                Cursor="Hand"
                Visibility="Collapsed"
                Click="DoneButton_Click">
            <Button.Effect>
                <DropShadowEffect Color="Black" BlurRadius="5" ShadowDepth="2" Opacity="0.5"/>
            </Button.Effect>
        </Button>
    </Grid>
</Window>
